<!--
  @file pages/myProductsModal.html
  @description هيكل النافذة المنبثقة لعرض "منتجاتي".
-->
<!-- ✅ جديد: حاوية رسالة انقطاع الاتصال -->
<div id="offline-container-modal" class="offline-container" style="display: none; position: absolute; border-radius: 12px;">
  <div class="offline-content">
    <i class="fas fa-exclamation-triangle"></i>
    <h2>لا يوجد اتصال بالإنترنت</h2>
    <p>يرجى التحقق من اتصالك بالشبكة والمحاولة مرة أخرى.</p>
    <button id="retry-connection-btn-modal" class="button login-btn">إعادة المحاولة</button>
  </div>
</div>

<div id="modal-main-content">
<div class="modal-content">
  <!-- ✅ تعديل: تحويل زر الإغلاق إلى أيقونة داخل زر لتوحيد التصميم -->
  <button class="close-button" id="my-products-modal-close-btn" aria-label="إغلاق"><i class="fas fa-times"></i></button>
  <h2><i class="fas fa-boxes-stacked"></i> منتجاتي</h2>

  <!-- جديد: إضافة حقل البحث -->
  <div class="my-products-search-container">
    <i class="fas fa-search search-icon"></i>
    <input type="search" id="my-products-search-input" placeholder="ابحث باسم المنتج..." autocomplete="off">
  </div>

  <!-- جديد: إضافة فلاتر الفئات -->
  <div class="my-products-filter-container">
    <div class="filter-group">
      <label for="my-products-main-category"><i class="fas fa-layer-group"></i> الفئة الرئيسية</label>
      <select id="my-products-main-category"><option value="">الكل</option></select>
    </div>
    <div class="filter-group" id="my-products-sub-category-group" style="display: none;">
      <label for="my-products-sub-category"><i class="fas fa-tags"></i> الفئة الفرعية</label>
      <select id="my-products-sub-category"><option value="">الكل</option></select>
    </div>
  </div>

  <div id="my-products-content-wrapper">
    <!-- سيتم عرض مؤشر التحميل أو جدول المنتجات هنا -->
  </div>
</div>
</div>

<script>
  // ✅ جديد: التحقق من الاتصال بالإنترنت عند تحميل هذا الجزء
  (async function() {
    if (typeof checkInternetConnection === 'undefined') {
      console.error("utils.js is not loaded. Cannot check internet connection.");
      return;
    }
    const isOnline = await checkInternetConnection();
    if (!isOnline) {
      document.getElementById('offline-container-modal').style.display = 'flex';
      document.getElementById('modal-main-content').style.display = 'none';
      document.getElementById('retry-connection-btn-modal').addEventListener('click', () => {
        const user = JSON.parse(localStorage.getItem("loggedInUser"));
        if (user && typeof showMyProducts === 'function') {
          showMyProducts(user.user_key);
        }
      });
    }
  })();
</script>