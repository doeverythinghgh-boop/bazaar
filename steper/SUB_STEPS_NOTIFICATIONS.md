# โ ูุธุงู ุงูุฅุดุนุงุฑุงุช ูููุฑุงุญู ุงููุฑุนูุฉ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ ูุธุงู ุดุงูู ูุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ ูููุฑุงุญู ุงููุฑุนูุฉ (ููุบูุ ูุฑููุถุ ูุฑุชุฌุน) ุจุนุฏ ุชุฃููุฏ ุงููุฑุงุญู ุงูุฑุฆูุณูุฉ ุงููุฑุชุจุทุฉ ุจูุง.

---

## ๐ฏ **ุขููุฉ ุงูุนูู**

### **ุงููุฑุงุญู ุงููุฑุนูุฉ ุชููุนูู ุชููุงุฆูุงู:**
- **ููุบู**: ุนูุฏูุง ููุบู ุงููุดุชุฑู ููุชุฌุงุช ูู ูุฑุญูุฉ "ูุฑุงุฌุนุฉ"
- **ูุฑููุถ**: ุนูุฏูุง ูุฑูุถ ุงูุจุงุฆุน ููุชุฌุงุช ูู ูุฑุญูุฉ "ุชุฃููุฏ"
- **ูุฑุชุฌุน**: ุนูุฏูุง ูุฑุฌุน ุงููุดุชุฑู ููุชุฌุงุช ูู ูุฑุญูุฉ "ุชุณููู"

### **ุงูุฅุดุนุงุฑุงุช ุชูุฑุณู ุจุนุฏ ุชุฃููุฏ ุงููุฑุญูุฉ ุงูุฑุฆูุณูุฉ:**
```
ุงููุณุชุฎุฏู ููุนูู ุงููุฑุญูุฉ ุงูุฑุฆูุณูุฉ
         โ
ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุงููุฑุญูุฉ ุงูุฑุฆูุณูุฉ
         โ
ุงูุชุญูู ูู ูุฌูุฏ ูุฑุงุญู ูุฑุนูุฉ
         โ
ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุงููุฑุงุญู ุงููุฑุนูุฉ (ุฅู ูุฌุฏุช)
```

---

## ๐ **ุฌุฏูู ุงูุฅุดุนุงุฑุงุช**

| ุงููุฑุญูุฉ ุงููุฑุนูุฉ | ูุชู ุชูุฑุณู | ุงููุณุชูููู |
|-----------------|-----------|-----------|
| **ููุบู** (step-cancelled) | ุจุนุฏ ุชูุนูู "ูุฑุงุฌุนุฉ" | ุงูุจุงุฆุนูู + ุงูุฅุฏุงุฑุฉ |
| **ูุฑููุถ** (step-rejected) | ุจุนุฏ ุชูุนูู "ุชุฃููุฏ" | ุงููุดุชุฑู + ุงูุฅุฏุงุฑุฉ |
| **ูุฑุชุฌุน** (step-returned) | ุจุนุฏ ุชูุนูู "ุชุณููู" | ุงูุจุงุฆุนูู + ุงูุฅุฏุงุฑุฉ |

---

## ๐ฌ **ุฃูุซูุฉ ุนูู ุงูุฅุดุนุงุฑุงุช**

### **1๏ธโฃ ูุฑุญูุฉ "ููุบู" (step-cancelled)**

**ุงูุณููุงุฑูู:**
- ุงููุดุชุฑู ููุชุญ ูุงูุฐุฉ "ุงุฎุชุฑ ุงูููุชุฌุงุช"
- ููุบู ุชุญุฏูุฏ 2 ููุชุฌุงุช
- ูุถุบุท ุนูู checkbox "ุชูุนูู ุงููุฑุญูุฉ" ููุฑุญูุฉ "ูุฑุงุฌุนุฉ"
- ูุคูุฏ ุงูุชูุนูู

**ุงูุฅุดุนุงุฑุงุช ุงูููุฑุณูุฉ:**

**ููุจุงุฆุนูู:**
```
ุงูุนููุงู: ููุชุฌุงุช ููุบุงุฉ
ุงููุต: ุงููุดุชุฑู ุฃูุบู ุจุนุถ ููุชุฌุงุชู ูู ุงูุทูุจ #123.
```

**ููุฅุฏุงุฑุฉ:**
```
ุงูุนููุงู: ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ
ุงููุต: ุชู ุชูุนูู ูุฑุญูุฉ "ููุบู" ููุทูุจ #123 ุจูุงุณุทุฉ ุฃุญูุฏ.
```

---

### **2๏ธโฃ ูุฑุญูุฉ "ูุฑููุถ" (step-rejected)**

**ุงูุณููุงุฑูู:**
- ุงูุจุงุฆุน ููุชุญ ูุงูุฐุฉ "ุชุฃููุฏ ุงูููุชุฌุงุช (ุจุงุฆุน)"
- ููุบู ุชุญุฏูุฏ 3 ููุชุฌุงุช (ุบูุฑ ูุชููุฑุฉ)
- ูุถุบุท ุนูู checkbox "ุชูุนูู ุงููุฑุญูุฉ" ููุฑุญูุฉ "ุชุฃููุฏ"
- ูุคูุฏ ุงูุชูุนูู

**ุงูุฅุดุนุงุฑุงุช ุงูููุฑุณูุฉ:**

**ูููุดุชุฑู:**
```
ุงูุนููุงู: ููุชุฌุงุช ูุฑููุถุฉ
ุงููุต: ุชู ุฑูุถ ุจุนุถ ุงูููุชุฌุงุช ูู ุทูุจู ุฑูู #123 ูุนุฏู ุชููุฑูุง.
```

**ููุฅุฏุงุฑุฉ:**
```
ุงูุนููุงู: ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ
ุงููุต: ุชู ุชูุนูู ูุฑุญูุฉ "ูุฑููุถ" ููุทูุจ #123 ุจูุงุณุทุฉ ูุญูุฏ.
```

---

### **3๏ธโฃ ูุฑุญูุฉ "ูุฑุชุฌุน" (step-returned)**

**ุงูุณููุงุฑูู:**
- ุงููุดุชุฑู/ุงูุณุงุนู ููุชุญ ูุงูุฐุฉ "ุชุฃููุฏ ุงุณุชูุงู ุงูููุชุฌุงุช"
- ููุบู ุชุญุฏูุฏ ููุชุฌ ูุงุญุฏ (ูู ูุณุชููู)
- ูุถุบุท ุนูู checkbox "ุชูุนูู ุงููุฑุญูุฉ" ููุฑุญูุฉ "ุชุณููู"
- ูุคูุฏ ุงูุชูุนูู

**ุงูุฅุดุนุงุฑุงุช ุงูููุฑุณูุฉ:**

**ููุจุงุฆุนูู:**
```
ุงูุนููุงู: ููุชุฌุงุช ูุฑุชุฌุนุฉ
ุงููุต: ุงููุดุชุฑู ุฃุฑุฌุน ุจุนุถ ููุชุฌุงุชู ูู ุงูุทูุจ #123.
```

**ููุฅุฏุงุฑุฉ:**
```
ุงูุนููุงู: ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ
ุงููุต: ุชู ุชูุนูู ูุฑุญูุฉ "ูุฑุชุฌุน" ููุทูุจ #123 ุจูุงุณุทุฉ ุนูู.
```

---

## ๐ง **ุงููููุงุช ุงููุนุฏูุฉ**

### **1. `notification/notificationTools.js`**

**ุชู ุฅุถุงูุฉ ุฏุงูุชูู ุฌุฏูุฏุชูู:**

#### ุฃ) `notifySellerOnStepChange(sellerKeys, stepId, stepName, orderId)`
- **ุงูุบุฑุถ**: ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ููุจุงุฆุนูู
- **ุงููุฑุงุญู**: ููุบูุ ูุฑุชุฌุน
- **ุงูุณุทูุฑ**: 605-650

#### ุจ) `notifyOnSubStepActivation(params)`
- **ุงูุบุฑุถ**: ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ ูุฅุฏุงุฑุฉ ุฅุดุนุงุฑุงุช ุงููุฑุงุญู ุงููุฑุนูุฉ
- **ุงููุนุงููุงุช**:
  ```javascript
  {
    stepId: string,        // ูุนุฑู ุงููุฑุญูุฉ ุงููุฑุนูุฉ
    stepName: string,      // ุงุณู ุงููุฑุญูุฉ
    buyerKey: string,      // ูููุฑุญูุฉ "ูุฑููุถ"
    sellerKeys: array,     // ูููุฑุงุญู "ููุบู" ู "ูุฑุชุฌุน"
    orderId: string,
    userName: string
  }
  ```
- **ุงูุณุทูุฑ**: 652-730

---

### **2. `steper/popupHelpers.js`**

**ุชู ุฅุถุงูุฉ ุฏุงูุฉ ุฌุฏูุฏุฉ:**

#### `sendSubStepNotifications(stepToActivate, controlData, ordersData)`
- **ุงูุบุฑุถ**: ุงูุชุญูู ูู ูุฌูุฏ ูุฑุงุญู ูุฑุนูุฉ ูุฅุฑุณุงู ุฅุดุนุงุฑุงุชูุง
- **ุขููุฉ ุงูุนูู**:
  1. ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ูู `ordersData`
  2. ุงูุชุญูู ูู ุงููุฑุญูุฉ ุงูุฑุฆูุณูุฉ ุงูููุนูุฉ
  3. ูุฑุงุกุฉ ุญุงูุฉ ุงููุฑุญูุฉ ูู `localStorage`
  4. ุฅุฐุง ูุฌุฏุช ููุชุฌุงุช ููุบุงุฉ/ูุฑููุถุฉ/ูุฑุชุฌุนุฉ โ ุฅุฑุณุงู ุฅุดุนุงุฑุงุช
- **ุงูุณุทูุฑ**: 211-303

**ุชู ุชุนุฏูู:**
- ุงุณุชุฏุนุงุก `sendSubStepNotifications()` ูู ุงูุณุทุฑ 206

---

## ๐ **ุชุฏูู ุงูุนูู ุงููุงูู**

### **ูุซุงู: ูุฑุญูุฉ "ููุบู"**

```
1. ุงููุดุชุฑู ููุชุญ ูุงูุฐุฉ "ุงุฎุชุฑ ุงูููุชุฌุงุช"
   โ
2. ููุบู ุชุญุฏูุฏ ููุชุฌูู
   - ูุชู ุญูุธ ูู: step-review.unselectedKeys
   โ
3. ูุถุบุท checkbox "ุชูุนูู ุงููุฑุญูุฉ" (ูุฑุงุฌุนุฉ)
   โ
4. ูุคูุฏ ุงูุชูุนูู
   โ
5. sendStepActivationNotifications()
   โโ ุฅุฑุณุงู ุฅุดุนุงุฑุงุช "ูุฑุงุฌุนุฉ" (ุงููุดุชุฑู + ุงูุฅุฏุงุฑุฉ)
   โโ sendSubStepNotifications()
      โโ ุงูุชุญูู: stepId === 'step-review'
      โโ ูุฑุงุกุฉ: loadStepState('step-review')
      โโ ุงูุดุฑุท: unselectedKeys.length > 0 โ
      โโ notifyOnSubStepActivation()
         โโ ๐จโ๐ผ ุฅุดุนุงุฑ ุงูุจุงุฆุนูู
         โโ ๐จโ๐ผ ุฅุดุนุงุฑ ุงูุฅุฏุงุฑุฉ
```

---

## ๐จ **ุงูููุฒุงุช**

- โ **ุชููุงุฆู 100%** - ููุฑุณู ุจุนุฏ ุชุฃููุฏ ุงููุฑุญูุฉ ุงูุฑุฆูุณูุฉ ูุจุงุดุฑุฉ
- โ **ุฐูู** - ูุชุญูู ูู ูุฌูุฏ ููุชุฌุงุช ูุนูุงู ูุจู ุงูุฅุฑุณุงู
- โ **ุฑุณุงุฆู ูุฎุตุตุฉ** - ููู ูุฑุญูุฉ ูููู ุฏูุฑ
- โ **ูุง ูุคุซุฑ ุนูู ุงูุฃุฏุงุก** - ููุฑุณู ุจุงูุชูุงุฒู
- โ **ุขูู** - ูุดู ุงูุฅุฑุณุงู ูุง ูุคุซุฑ ุนูู ุชูุนูู ุงููุฑุญูุฉ

---

## ๐ **ูุง ุณุชุฑุงู ูู Console**

### **ุนูุฏ ุชูุนูู "ูุฑุงุฌุนุฉ" ูุน ูุฌูุฏ ููุชุฌุงุช ููุบุงุฉ:**
```
[Notifications] ุจุฏุก ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุชูุนูู ุงููุฑุญูุฉ: ูุฑุงุฌุนุฉ (step-review)
[Notifications] ุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุดุชุฑู...
[Notifications] ุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ููุฅุฏุงุฑุฉ...
[Notifications] โ ุชู ุฅุฑุณุงู ุฌููุน ุงูุฅุดุนุงุฑุงุช ุจูุฌุงุญ ูููุฑุญูุฉ: ูุฑุงุฌุนุฉ
[Notifications] ุชู ุงุณุชุฏุนุงุก ุฏุงูุฉ ุงูุฅุดุนุงุฑุงุช ูููุฑุญูุฉ: ูุฑุงุฌุนุฉ
[Notifications] ุชู ุงูุชุดุงู ููุชุฌุงุช ููุบุงุฉุ ุฅุฑุณุงู ุฅุดุนุงุฑุงุช...
[Notifications] ุจุฏุก ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุงููุฑุญูุฉ ุงููุฑุนูุฉ: ููุบู (step-cancelled)
[Notifications] ุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ููุจุงุฆุนูู (2) ุนู ุงููุฑุญูุฉ ููุบู
[Notifications] ุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ููุฅุฏุงุฑุฉ ุนู ุงููุฑุญูุฉ ููุบู
[Notifications] โ ุชู ุฅุฑุณุงู ุฌููุน ุฅุดุนุงุฑุงุช ุงููุฑุญูุฉ ุงููุฑุนูุฉ: ููุบู
```

---

## โ๏ธ **ููุงุญุธุงุช ูููุฉ**

1. **ุงูุฅุดุนุงุฑุงุช ุชูุฑุณู ููุท ุฅุฐุง ูุฌุฏุช ููุชุฌุงุช:**
   - ููุบู: `unselectedKeys.length > 0`
   - ูุฑููุถ: `deselectedKeys.length > 0`
   - ูุฑุชุฌุน: `returnedKeys.length > 0`

2. **ุงูุชูููุช**: ุงูุฅุดุนุงุฑุงุช ุชูุฑุณู **ุจุนุฏ** ุชุฃููุฏ ุงููุฑุญูุฉ ุงูุฑุฆูุณูุฉุ ูููุณ ุนูุฏ ุฅูุบุงุก ุชุญุฏูุฏ ุงูููุชุฌุงุช

3. **ุงูุจุงุฆุนูู**: ูุชู ุงุณุชุฎุฑุงุฌ ุฌููุน ุงูุจุงุฆุนูู ูู `order_items.seller_key`

4. **ุงูุฃูุงู**: ุฌููุน ุงูุฏูุงู ูุญููุฉ ุจู `try-catch`

---

## ๐งช **ุงูุงุฎุชุจุงุฑ**

### **ุงุฎุชุจุงุฑ ูุฑุญูุฉ "ููุบู":**
```javascript
// ูู Console
await notifyOnSubStepActivation({
    stepId: 'step-cancelled',
    stepName: 'ููุบู',
    sellerKeys: ['seller_key_1', 'seller_key_2'],
    orderId: '123',
    userName: 'ุฃุญูุฏ'
});
```

### **ุงุฎุชุจุงุฑ ูุฑุญูุฉ "ูุฑููุถ":**
```javascript
await notifyOnSubStepActivation({
    stepId: 'step-rejected',
    stepName: 'ูุฑููุถ',
    buyerKey: 'user_key_1',
    orderId: '123',
    userName: 'ูุญูุฏ'
});
```

### **ุงุฎุชุจุงุฑ ูุฑุญูุฉ "ูุฑุชุฌุน":**
```javascript
await notifyOnSubStepActivation({
    stepId: 'step-returned',
    stepName: 'ูุฑุชุฌุน',
    sellerKeys: ['seller_key_1'],
    orderId: '123',
    userName: 'ุนูู'
});
```

---

## โ **ุงูุฎูุงุตุฉ**

**ุชู ุฅุถุงูุฉ ูุธุงู ุดุงูู ูููุฑุงุญู ุงููุฑุนูุฉ:**

| ุงููุฑุญูุฉ | ุงููุฑุญูุฉ ุงูุฑุฆูุณูุฉ | ุงูุฅุดุนุงุฑุงุช |
|---------|------------------|-----------|
| **ููุบู** | ุจุนุฏ "ูุฑุงุฌุนุฉ" | ุงูุจุงุฆุนูู + ุงูุฅุฏุงุฑุฉ |
| **ูุฑููุถ** | ุจุนุฏ "ุชุฃููุฏ" | ุงููุดุชุฑู + ุงูุฅุฏุงุฑุฉ |
| **ูุฑุชุฌุน** | ุจุนุฏ "ุชุณููู" | ุงูุจุงุฆุนูู + ุงูุฅุฏุงุฑุฉ |

**ุฌููุน ุงูุฅุดุนุงุฑุงุช ุชูุฑุณู ุชููุงุฆูุงู ุจุนุฏ ุชุฃููุฏ ุงููุฑุญูุฉ ุงูุฑุฆูุณูุฉ!** ๐

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก**: 2025-12-11  
**ุงูุญุงูุฉ**: โ ููุชูู ูุฌุงูุฒ ููุงุณุชุฎุฏุงู
