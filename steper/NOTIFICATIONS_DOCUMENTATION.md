# ๐ข ูุธุงู ุงูุฅุดุนุงุฑุงุช ุนูุฏ ุชูุนูู ุงููุฑุงุญู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ ูุธุงู ุดุงูู ูุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช ุชููุงุฆูุงู ุนูุฏ ุชูุนูู ุฃู ูุฑุญูุฉ ูู ูุธุงู ุชุชุจุน ุงูุทูุจุงุช (Stepper). ูููู ุงููุธุงู ุจุฅุฑุณุงู ุฅุดุนุงุฑุงุช ูุฎุตุตุฉ ููู ูู:
- **ุงููุดุชุฑู** (Buyer)
- **ุงูุฅุฏุงุฑุฉ** (Admin)
- **ุฎุฏูุงุช ุงูุชูุตูู** (Delivery Services)

---

## ๐ง ุงููููุงุช ุงููุนุฏูุฉ

### 1. `notification/notificationTools.js`
ุชูุช ุฅุถุงูุฉ 4 ุฏูุงู ุฌุฏูุฏุฉ:

#### ุฃ) `notifyBuyerOnStepChange(buyerKey, stepId, stepName, orderId)`
- **ุงูุบุฑุถ**: ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุดุชุฑู ุนูุฏ ุชุบููุฑ ุญุงูุฉ ุงูุทูุจ
- **ุงูุฑุณุงุฆู ุงููุฎุตุตุฉ**:
  - `step-review`: "ุชู ุงุณุชูุงู ุทูุจู. ูุฑุฌู ูุฑุงุฌุนุฉ ุงูููุชุฌุงุช."
  - `step-confirmed`: "ุชู ุชุฃููุฏ ุทูุจู ูู ูุจู ุงูุจุงุฆุน. ุฌุงุฑู ุงูุชุฌููุฒ ููุดุญู."
  - `step-shipped`: "ุชู ุดุญู ุทูุจู. ูู ุงูุทุฑูู ุฅููู!"
  - `step-delivered`: "ุชู ุชุณููู ุทูุจู ุจูุฌุงุญ."

#### ุจ) `notifyAdminOnStepChange(stepId, stepName, orderId, userName)`
- **ุงูุบุฑุถ**: ุฅุฑุณุงู ุฅุดุนุงุฑ ููุฅุฏุงุฑุฉ ุจุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ
- **ุงูุฑุณุงูุฉ**: "ุชู ุชูุนูู ูุฑุญูุฉ [ุงุณู ุงููุฑุญูุฉ] ููุทูุจ #[ุฑูู ุงูุทูุจ] ุจูุงุณุทุฉ [ุงุณู ุงููุณุชุฎุฏู]"

#### ุฌ) `notifyDeliveryOnStepChange(deliveryKeys, stepId, stepName, orderId)`
- **ุงูุบุฑุถ**: ุฅุฑุณุงู ุฅุดุนุงุฑ ูุฎุฏูุงุช ุงูุชูุตูู
- **ุงููุฑุงุญู ุงููุณุชูุฏูุฉ**: `step-confirmed`, `step-shipped`, `step-delivered`
- **ุงูุฑุณุงุฆู ุงููุฎุตุตุฉ**:
  - `step-confirmed`: "ุชู ุชุฃููุฏ ุทูุจ ูุฌุงูุฒ ููุดุญู. ูุฑุฌู ุงูุงุณุชุนุฏุงุฏ ููุชูุตูู."
  - `step-shipped`: "ุชู ุดุญู ุงูุทูุจ. ูุฑุฌู ุงูุชูุตูู ููุนููู."
  - `step-delivered`: "ุชู ุชุณููู ุงูุทูุจ ุจูุฌุงุญ."

#### ุฏ) `notifyOnStepActivation(params)` - **ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ**
- **ุงููุนุงููุงุช**:
  ```javascript
  {
    stepId: string,        // ูุนุฑู ุงููุฑุญูุฉ
    stepName: string,      // ุงุณู ุงููุฑุญูุฉ ุจุงูุนุฑุจูุฉ
    buyerKey: string,      // ููุชุงุญ ุงููุดุชุฑู
    deliveryKeys: array,   // ููุงุชูุญ ุฎุฏูุงุช ุงูุชูุตูู
    orderId: string,       // ุฑูู ุงูุทูุจ
    userName: string       // ุงุณู ุงููุณุชุฎุฏู ุงูุฐู ูุนูู ุงููุฑุญูุฉ
  }
  ```
- **ุขููุฉ ุงูุนูู**: ุชุฑุณู ุงูุฅุดุนุงุฑุงุช ุจุงูุชูุงุฒู (Parallel) ูุชุญุณูู ุงูุฃุฏุงุก

---

### 2. `steper/popupHelpers.js`
ุชูุช ุฅุถุงูุฉ ุฏุงูุฉ ูุณุงุนุฏุฉ ุฌุฏูุฏุฉ:

#### `sendStepActivationNotifications(stepToActivate, controlData, ordersData)`
- **ุงูุบุฑุถ**: ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ุงููุงุฒูุฉ ูู `ordersData` ูุงุณุชุฏุนุงุก `notifyOnStepActivation`
- **ุงูุจูุงูุงุช ุงููุณุชุฎุฑุฌุฉ**:
  - `buyerKey`: ูู `ordersData[0].user_key`
  - `orderId`: ูู `ordersData[0].id` ุฃู `ordersData[0].order_id`
  - `userName`: ูู `controlData.currentUser.name`
  - `deliveryKeys`: ูู ุฌููุน ุงูููุชุฌุงุช ูู `order_items.supplier_delivery.delivery_key`

**ุงูุชุนุฏูู ุนูู `addStatusToggleListener`**:
- ุชู ุฅุถุงูุฉ ุงุณุชุฏุนุงุก `sendStepActivationNotifications` ุจุนุฏ ุญูุธ ุงูุญุงูุฉ ุงูุฌุฏูุฏุฉ (ุงูุณุทุฑ 116)

---

## ๐ ุชุฏูู ุงูุนูู ุงููุงูู

```
1. ุงููุณุชุฎุฏู ูุถุบุท ุนูู checkbox "ุชูุนูู ุงููุฑุญูุฉ"
   โ
2. ุงูุชุญูู ูู ุงูุชุณูุณู ุงูุตุญูุญ ูููุฑุงุญู
   โ
3. ุทูุจ ุชุฃููุฏ ูู ุงููุณุชุฎุฏู
   โ
4. ุงููุณุชุฎุฏู ูุคูุฏ ุงูุชูุนูู
   โ
5. ุญูุธ ุงูุญุงูุฉ ุงูุฌุฏูุฏุฉ ูู localStorage
   โ
6. ุงุณุชุฏุนุงุก sendStepActivationNotifications()
   โโ ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ูู ordersData
   โโ ุงุณุชุฏุนุงุก notifyOnStepActivation()
   โ  โโ notifyBuyerOnStepChange() โ ุฅุฑุณุงู ูููุดุชุฑู
   โ  โโ notifyAdminOnStepChange() โ ุฅุฑุณุงู ููุฅุฏุงุฑุฉ
   โ  โโ notifyDeliveryOnStepChange() โ ุฅุฑุณุงู ูุฎุฏูุงุช ุงูุชูุตูู
   โ
7. ุชุญุฏูุซ ุงููุงุฌูุฉ (UI)
   โ
8. ุฅุบูุงู ุงููุงูุฐุฉ ุงูููุจุซูุฉ
```

---

## ๐ ูุซุงู ุนูู ุงูุฅุดุนุงุฑุงุช ุงููุฑุณูุฉ

### ุนูุฏ ุชูุนูู ูุฑุญูุฉ "ุชุฃููุฏ" (step-confirmed):

**ูููุดุชุฑู:**
```
ุงูุนููุงู: ุชู ุชุฃููุฏ ุงูุทูุจ
ุงููุต: ุชู ุชุฃููุฏ ุทูุจู ุฑูู #123 ูู ูุจู ุงูุจุงุฆุน. ุฌุงุฑู ุงูุชุฌููุฒ ููุดุญู.
```

**ููุฅุฏุงุฑุฉ:**
```
ุงูุนููุงู: ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ
ุงููุต: ุชู ุชูุนูู ูุฑุญูุฉ "ุชุฃููุฏ" ููุทูุจ #123 ุจูุงุณุทุฉ ุฃุญูุฏ ูุญูุฏ.
```

**ูุฎุฏูุงุช ุงูุชูุตูู:**
```
ุงูุนููุงู: ุทูุจ ุฌุฏูุฏ ููุชูุตูู
ุงููุต: ุชู ุชุฃููุฏ ุทูุจ #123 ูุฌุงูุฒ ููุดุญู. ูุฑุฌู ุงูุงุณุชุนุฏุงุฏ ููุชูุตูู.
```

---

## โ๏ธ ุงููุชุทูุจุงุช

### ุงููููุงุช ุงููุทููุจุฉ:
1. โ `notification/notificationTools.js` - ูุฌุจ ุชุญูููู ูุจู `steper/popupHelpers.js`
2. โ `steper/popupHelpers.js` - ูุญุชูู ุนูู ููุทู ุงูุชูุนูู
3. โ `steper/uiUpdates.js` - ูุฅูุดุงุก footer ุงูู checkbox
4. โ `steper/stateManagement.js` - ูุญูุธ ุงูุญุงูุฉ

### ุงูุชุญููู ูู `index.html`:
```html
<script src="notification/notificationTools.js"></script>
```
โ **ุชู ุจุงููุนู** (ุงูุณุทุฑ 295 ูู `index.html`)

---

## ๐ฏ ุงูููุฒุงุช

1. โ **ุฅุฑุณุงู ุชููุงุฆู** ุนูุฏ ุชูุนูู ุฃู ูุฑุญูุฉ
2. โ **ุฑุณุงุฆู ูุฎุตุตุฉ** ููู ูุฑุญูุฉ ูููู ุฏูุฑ
3. โ **ุฅุฑุณุงู ูุชูุงุฒู** (Parallel) ูุชุญุณูู ุงูุฃุฏุงุก
4. โ **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก** ุงูุดุงููุฉ
5. โ **ุฏุนู delivery_key** ูู string ุฃู array
6. โ **ุชุณุฌูู ููุตู** ูู Console ููุชุชุจุน

---

## ๐ ุงูุชุญูู ูู ุนูู ุงููุธุงู

### ูู Console:
```javascript
// ุนูุฏ ุชูุนูู ูุฑุญูุฉุ ุณุชุธูุฑ ุงูุฑุณุงุฆู ุงูุชุงููุฉ:
[Notifications] ุจุฏุก ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุชูุนูู ุงููุฑุญูุฉ: ุชุฃููุฏ (step-confirmed)
[Notifications] ุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุดุชุฑู user_key_1 ุนู ุงููุฑุญูุฉ ุชุฃููุฏ
[Notifications] ุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ููุฅุฏุงุฑุฉ ุนู ุงููุฑุญูุฉ ุชุฃููุฏ
[Notifications] ุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ูุฎุฏูุงุช ุงูุชูุตูู (2) ุนู ุงููุฑุญูุฉ ุชุฃููุฏ
[Notifications] โ ุชู ุฅุฑุณุงู ุฌููุน ุงูุฅุดุนุงุฑุงุช ุจูุฌุงุญ ูููุฑุญูุฉ: ุชุฃููุฏ
```

---

## ๐๏ธ ุงูุชุฎุตูุต

### ูุชุฎุตูุต ุงูุฑุณุงุฆู:
ุนุฏูู ุงูุฏูุงู ูู `notification/notificationTools.js`:
- `notifyBuyerOnStepChange` - ุงูุณุทุฑ 417-465
- `notifyAdminOnStepChange` - ุงูุณุทุฑ 467-492
- `notifyDeliveryOnStepChange` - ุงูุณุทุฑ 494-544

### ูุฅุถุงูุฉ ูุฑุงุญู ุฌุฏูุฏุฉ:
ุฃุถู ุญุงูุฉ ุฌุฏูุฏุฉ ูู `switch` statement ุฏุงุฎู ูู ุฏุงูุฉ.

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ุงูุชูููุงุช**: ูุฌุจ ุฃู ุชููู ุชูููุงุช FCM ูุญููุธุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. **ุงูุฃุฏุงุก**: ุงูุฅุดุนุงุฑุงุช ุชูุฑุณู ุจุงูุชูุงุฒู ููุง ุชุนูู ุชุญุฏูุซ ุงููุงุฌูุฉ
3. **ุงูุฃุฎุทุงุก**: ูุดู ุฅุฑุณุงู ุฅุดุนุงุฑ ูุง ูุคุซุฑ ุนูู ุชูุนูู ุงููุฑุญูุฉ
4. **ุงูุชุณุฌูู**: ุฌููุน ุงูุนูููุงุช ูุณุฌูุฉ ูู Console ููุชุชุจุน

---

## ๐ ุงูููุฏ ุงููุถุงู

### ูู `notificationTools.js`:
- **ุงูุณุทูุฑ**: 416-603 (188 ุณุทุฑ ุฌุฏูุฏ)
- **ุงูุฏูุงู**: 4 ุฏูุงู ุฌุฏูุฏุฉ

### ูู `popupHelpers.js`:
- **ุงูุณุทูุฑ**: 116 (ุงุณุชุฏุนุงุก)ุ 134-210 (77 ุณุทุฑ ุฌุฏูุฏ)
- **ุงูุฏูุงู**: 1 ุฏุงูุฉ ุฌุฏูุฏุฉ

---

## โ ุงูุงุฎุชุจุงุฑ

ูุงุฎุชุจุงุฑ ุงููุธุงู:
1. ุงูุชุญ `steper/stepper-only.html`
2. ุงุถุบุท ุนูู ุฃู ูุฑุญูุฉ
3. ุงุถุบุท ุนูู checkbox "ุชูุนูู ุงููุฑุญูุฉ"
4. ุฃูุฏ ุงูุชูุนูู
5. ุชุญูู ูู Console ููุฑุณุงุฆู
6. ุชุญูู ูู ูุตูู ุงูุฅุดุนุงุฑุงุช ูููุณุชุฎุฏููู

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก**: 2025-12-11  
**ุงูุฅุตุฏุงุฑ**: 1.0  
**ุงูุญุงูุฉ**: โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู
