نعم، بالتأكيد. هذا سؤال ممتاز جداً ويكشف عن فهم عميق لآلية عمل الإشعارات.
الإجابة المختصرة: نعم، يمكنك إرسال إشعارات من تطبيق الأندرويد نفسه إلى أجهزة أخرى مثبت عليها نفس التطبيق، ولكن لا يمكنك استخدام رمز FCM لإرسال إشعار إلى نفس الجهاز الذي حصلت منه على الرمز.
الإجابة التفصيلية (وهي الأهم):
لإرسال إشعارات من جهاز إلى جهاز آخر (Peer-to-Peer) باستخدام Firebase، ستحتاج إلى شيئين:
1.
رمز FCM الخاص بالجهاز المستقبِل (الجهاز الذي تريد إرسال الإشعار إليه).
2.
مفتاح الخادم (Server Key) الخاص بمشروعك على Firebase. هذا المفتاح بمثابة "كلمة مرور" تسمح لك باستخدام واجهة برمجة تطبيقات FCM (FCM API) لإرسال الإشعارات.
الفكرة هنا هي أن تطبيقك سيعمل كخادم مؤقت أو "Initiator" لعملية الإرسال.
كيف يتم ذلك خطوة بخطوة؟
لنفترض أنك تريد من المستخدم (أ) أن يرسل إشعاراً إلى المستخدم (ب).
الخطوة 1: تخزين رموز FCM للمستخدمين
عندما يقوم أي مستخدم (مثل المستخدم "ب") بتسجيل الدخول إلى تطبيقك، يقوم التطبيق بالحصول على رمز FCM الخاص به. بدلاً من إرسال هذا الرمز إلى خادمك الخاص، ستحتاج إلى تخزينه في قاعدة بيانات يمكن الوصول إليها من قبل المستخدمين الآخرين. أفضل وأسهل طريقة لذلك هي استخدام Firebase Realtime Database أو Firestore.
مثال على الهيكل في Firestore:
•
Collection: users
•
Document: (معرّف المستخدم "ب" الفريد user_id_B)
•
Fields:
◦
name: "User B"
◦
fcmToken: "رمز_FCM_الخاص_بالمستخدم_ب"
الخطوة 2: الحصول على مفتاح الخادم (Server Key) من Firebase
1.
اذهب إلى Firebase Console.
2.
اختر مشروعك.
3.
اضغط على أيقونة الإعدادات (⚙️) واختر Project settings.
4.
اذهب إلى تبويب Cloud Messaging.
5.
تحت قسم Cloud Messaging API (Legacy)، ستجد مفتاح الخادم (Server key). انسخ هذا المفتاح. (تحذير: هذا المفتاح سري جداً، لا تشاركه في الكود المفتوح المصدر).
الخطوة 3: بناء وإرسال طلب الإشعار من تطبيق المستخدم (أ)
عندما يريد المستخدم "أ" إرسال إشعار إلى المستخدم "ب"، سيقوم تطبيق المستخدم "أ" بالآتي:
1.
البحث في Firestore عن معرّف المستخدم "ب" والحصول على رمز FCM الخاص به.
2.
بناء طلب HTTP POST إلى واجهة برمجة تطبيقات FCM.
3.
إضافة مفتاح الخادم الذي نسخته في الخطوة السابقة إلى رأس الطلب (Header).